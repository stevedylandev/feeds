<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#121113" />
    <link rel="stylesheet" href="./styles.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="https://feeds.stevedylan.dev/assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://feeds.stevedylan.dev/assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://feeds.stevedylan.dev/assets/favicon-16x16.png">
    <link rel="manifest" href="https://feeds.stevedylan.dev/assets/site.webmanifest">

    <title>Feeds</title>
   	<meta name="description" content="Minimal RSS Reading">

    <meta property="og:url" content="https://feeds.stevedylan.dev">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Feeds">
    <meta property="og:description" content="Minimal RSS Reading">
    <meta property="og:image" content="https://feeds.stevedylan.dev/assets/og.png">

    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="feeds.stevedylan.dev">
    <meta property="twitter:url" content="https://feeds.stevedylan.dev">
    <meta name="twitter:title" content="Feeds">
    <meta name="twitter:description" content="Minimal RSS Reading">
    <meta name="twitter:image" content="https://feeds.stevedylan.dev/assets/og.png">
  </head>
  <body>
    <a href="/" class="header">
      <h1>FEEDS</h1>
    </a>

    <div class="links">
      <a target="_blank" href="https://github.com/stevedylandev/Feeds">
        GitHub
      </a>
      <p>|</p>
      <p>by <a target="_blank" href="https://stevedylan.dev">Steve</a></p>
    </div>

    <div id="loading" style="display: none;">
      <p>Loading feeds...</p>
    </div>

    <div id="feed-urls" style="display: none;">
    </div>

    <div id="error" style="display: none; color: #ff6b6b;">
      <p>Error loading feeds. Please try again later.</p>
    </div>

    <div id="feeds-container">
      <!-- Feeds will be populated here -->
    </div>


    <script>

    async function loadFeeds() {
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const container = document.getElementById('feeds-container');
      const feedUrls = document.getElementById('feed-urls');

      // Show loading state
      loading.style.display = 'block';
      error.style.display = 'none';
      container.innerHTML = '';

      try {
        const urlParams = new URLSearchParams(window.location.search);
        // Dynamic URL fetching
        const urlParam = urlParams.get('url');
        const urlsParam = urlParams.get('urls');

        // Manual setting
        // const urlParam = "https://bearblog.dev/discover/feed/"

        let apiUrl = '/api/list';

        if (urlParam || urlsParam) {
          const feedUrlString = urlParam || urlsParam;
          apiUrl += `?url=${encodeURIComponent(feedUrlString)}`;
          feedUrls.style = "display: block;"
          feedUrls.innerHTML = `${(urlParam || urlsParam).split(',').join('<br>')}`
        }

        const response = await fetch(apiUrl);
        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to fetch feeds');
        }

        // Hide loading
        loading.style.display = 'none';

        if (!data.items || data.items.length === 0) {
          container.innerHTML = '<p class="no-feeds">No feeds available</p>';
          return;
        }

        // Create feeds list
        const feedsList = document.createElement('div');
        feedsList.className = 'feeds-list';

        // Sort items by published date (newest first)
        const sortedItems = data.items.sort((a, b) => b.published - a.published);

        sortedItems.forEach(item => {
          const feedItem = document.createElement('article');
          feedItem.className = 'feed-item';

          // Format date
          const publishedDate = new Date(item.published * 1000);
          const formattedDate = publishedDate.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });

          feedItem.innerHTML = `
            <div class="feed-meta">
              <span class="feed-date">${formattedDate}</span>
            </div>
            <h3 class="feed-title">
              <a href="${item.link}" target="_blank" rel="noopener noreferrer">
                ${item.title}
              </a>
            </h3>
            ${item.author ? `<p class="feed-author">by ${item.author}</p>` : ''}
          `;

          feedsList.appendChild(feedItem);
        });

        container.appendChild(feedsList);

      } catch (err) {
        console.error('Error loading feeds:', err);
        loading.style.display = 'none';
        error.style.display = 'block';
      }
    }

    // Load feeds when page loads
    document.addEventListener('DOMContentLoaded', loadFeeds);
    </script>
  </body>
</html>
